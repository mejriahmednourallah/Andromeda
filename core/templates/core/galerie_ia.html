{% extends "core/dashboard_base.html" %}

{% block title %}AI Gallery{% endblock %}

{% block content %}
<div style="margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <div>
            <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">AI Gallery</h1>
            <p style="color: var(--text-gray); font-size: 1rem;">Explore your memories through AI insights</p>
        </div>
        <form method="post" action="{% url 'core:analyser_tout_ia' %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn-primary">Analyze All Pending</button>
        </form>
    </div>
</div>

<!-- Stats Overview -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    <div class="card" style="text-align: center;">
        <p style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">{{ analyzed_count }}</p>
        <p style="color: var(--text-gray); font-size: 0.9rem;">AI Analyzed</p>
    </div>
    <div class="card" style="text-align: center;">
        <p style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">{{ pending_count }}</p>
        <p style="color: var(--text-gray); font-size: 0.9rem;">Pending Analysis</p>
    </div>
    <div class="card" style="text-align: center;">
        <p style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">{{ album_suggestions|length }}</p>
        <p style="color: var(--text-gray); font-size: 0.9rem;">Album Suggestions</p>
    </div>
</div>

<!-- AI Insights -->
{% if insights %}
<div class="card" style="margin-bottom: 2rem;">
    <h2 class="card-title">âœ¨ AI Insights</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
        <div style="border: 2px solid var(--border-color); padding: 1rem; background: white;">
            <h4 style="font-weight: bold; margin-bottom: 0.5rem;">Total Memories</h4>
            <p style="font-size: 1.5rem; font-weight: bold; color: var(--accent-orange);">{{ insights.total_memories }}</p>
        </div>
        <div style="border: 2px solid var(--border-color); padding: 1rem; background: white;">
            <h4 style="font-weight: bold; margin-bottom: 0.5rem;">Dominant Emotion</h4>
            <p style="font-size: 1.5rem; font-weight: bold; color: var(--accent-orange);">{{ insights.dominant_emotion|title }}</p>
        </div>
        <div style="border: 2px solid var(--border-color); padding: 1rem; background: white;">
            <h4 style="font-weight: bold; margin-bottom: 0.5rem;">AI Analyzed</h4>
            <p style="font-size: 1.5rem; font-weight: bold; color: var(--accent-orange);">{{ insights.analyzed_count }}</p>
        </div>
        <div style="border: 2px solid var(--border-color); padding: 1rem; background: white;">
            <h4 style="font-weight: bold; margin-bottom: 0.5rem;">With Media</h4>
            <p style="font-size: 1.5rem; font-weight: bold; color: var(--accent-orange);">{{ insights.with_media }}</p>
        </div>
    </div>
    
    {% if insights.most_common_themes %}
    <div style="margin-top: 1.5rem;">
        <h4 style="font-weight: bold; margin-bottom: 0.75rem;">Most Common Themes</h4>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
            {% for theme, count in insights.most_common_themes.items %}
            <span style="background: #e0f2fe; color: #0277bd; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.9rem; font-weight: bold;">{{ theme|title }} ({{ count }})</span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% if insights.emotion_distribution %}
    <div style="margin-top: 1.5rem;">
        <h4 style="font-weight: bold; margin-bottom: 0.75rem;">Emotion Distribution</h4>
        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
            {% for emotion, count in insights.emotion_distribution.items %}
            <span style="background: #f3e5f5; color: #7b1fa2; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.9rem; font-weight: bold;">{{ emotion|title }}: {{ count }}</span>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Analyzed Memories -->
{% if analyzed_memories %}
<div class="card" style="margin-bottom: 2rem;">
    <h2 class="card-title">AI-Enriched Memories</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
        {% for souvenir in analyzed_memories %}
        <div class="card" style="padding: 0; overflow: hidden;">
            {% if souvenir.photo %}
                <img src="{{ souvenir.photo.url }}" alt="{{ souvenir.titre }}" style="width: 100%; height: 200px; object-fit: cover;">
            {% else %}
                <div style="width: 100%; height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center;">
                    <span style="font-size: 2rem; color: white; font-weight: bold;">AI</span>
                </div>
            {% endif %}
            <div style="padding: 1.5rem;">
                <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 0.75rem;">{{ souvenir.titre }}</h3>
                <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 0.5rem;">{{ souvenir.date_evenement|date:"d/m/Y" }}</p>
                {% if souvenir.analyse_ia %}
                <div style="margin-bottom: 1rem;">
                    <p style="font-size: 0.85rem; color: var(--text-gray); margin-bottom: 0.25rem;"><strong>AI Summary:</strong></p>
                    <p style="font-size: 0.85rem; margin-bottom: 0.5rem;">{{ souvenir.analyse_ia.resume_genere|truncatewords:15 }}</p>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        {% for tag in souvenir.ai_tags %}
                        <span style="background: #e0f2fe; color: #0277bd; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">{{ tag }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                <a href="{% url 'core:detail_souvenir' souvenir.id %}" class="btn-primary" style="width: 100%; text-align: center;">View Details</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Pending Analysis -->
{% if pending_memories %}
<div class="card" style="margin-bottom: 2rem;">
    <h2 class="card-title">Pending AI Analysis</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
        {% for souvenir in pending_memories %}
        <div style="border: 2px solid var(--border-color); padding: 1rem; background: white;">
            <h4 style="font-weight: bold; margin-bottom: 0.5rem;">{{ souvenir.titre }}</h4>
            <p style="color: var(--text-gray); font-size: 0.85rem; margin-bottom: 0.5rem;">{{ souvenir.date_evenement|date:"d/m/Y" }}</p>
            <a href="{% url 'core:analyser_souvenir_ia' souvenir.id %}" class="btn-secondary" style="width: 100%; text-align: center; display: block;">Analyze</a>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Album Suggestions -->
{% if album_suggestions %}
<div class="card" style="margin-bottom: 2rem;">
    <h2 class="card-title">AI Album Suggestions</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
        {% for suggestion in album_suggestions %}
        <div style="border: 2px solid var(--border-color); padding: 1.5rem; background: white;">
            <h4 style="font-weight: bold; margin-bottom: 0.75rem;">{{ suggestion.title }}</h4>
            <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 1rem;">{{ suggestion.type|title }} album with {{ suggestion.count }} memories</p>
            <p style="font-size: 0.85rem; margin-bottom: 1rem;"><strong>Theme:</strong> {{ suggestion.theme|default:"Various"|title }}</p>
            <!-- Album creation can be added here if needed -->
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Reflection Prompts -->
{% if reflection_prompts %}
<div class="card">
    <h2 class="card-title">AI Reflection Prompts</h2>
    <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for prompt in reflection_prompts %}
        <div style="border: 2px solid var(--border-color); padding: 1rem; background: white;">
            <p style="font-style: italic; color: var(--text-gray);">{{ prompt }}</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endblock %}