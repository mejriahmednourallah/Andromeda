{% extends 'base.html' %}
{% load static %}

{% block title %}{% if note %}Edit{% else %}Create{% endif %} Note - Andromeda{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/notes-editor.css' %}">
{% endblock %}

{% block content %}
<div class="editor-container">
    <!-- TOOLBAR -->
    <div class="editor-toolbar">
        <div class="toolbar-left">
            <a href="{% url 'notes:list' %}" class="btn-icon" title="Back to Notes">
                <i class="fas fa-arrow-left"></i>
            </a>
            <button id="saveBtn" class="btn-primary">SAVE</button>
            <button id="saveDraftBtn" class="btn-secondary">SAVE DRAFT</button>
            <button id="aiConvertBtn" class="btn-secondary" title="AI: Convert MD â†’ Plain Text">AI: MDâ†’Text</button>
            <button id="aiToMdBtn" class="btn-secondary" title="AI: Convert Plain Text â†’ Markdown">AI: Textâ†’MD</button>
            <button id="previewMdBtn" class="btn-secondary" title="Preview compiled Markdown">Preview MD</button>
            <span id="autoSaveStatus" class="autosave-status"></span>
        </div>
        
        <div class="toolbar-right">
            <button class="btn-icon" title="Bold (Ctrl+B)" data-format="bold">
                <i class="fas fa-bold"></i>
            </button>
            <button class="btn-icon" title="Italic (Ctrl+I)" data-format="italic">
                <i class="fas fa-italic"></i>
            </button>
            <button class="btn-icon" title="Link (Ctrl+K)" data-format="link">
                <i class="fas fa-link"></i>
            </button>
            <button class="btn-icon" title="Heading" data-format="heading">
                <i class="fas fa-heading"></i>
            </button>
            <button class="btn-icon" title="Bullet List" data-format="ul">
                <i class="fas fa-list-ul"></i>
            </button>
            <button class="btn-icon" title="Code Block" data-format="code">
                <i class="fas fa-code"></i>
            </button>
            <!-- AI convert button moved to left toolbar for visibility -->
        </div>
    </div>
    
    <!-- EDITOR -->
    <div class="editor-content">
        <input 
            type="text" 
            id="noteTitle" 
            placeholder="Untitled Note" 
            class="note-title-input"
            value="{% if note %}{{ note.title }}{% endif %}"
        >
        
        <div class="editor-meta">
            <input 
                type="text" 
                id="noteTags" 
                placeholder="Add tags (comma separated)..." 
                class="note-tags-input"
                value="{% if note %}{{ note.tags.all|join:', ' }}{% endif %}"
            >
            <label class="pin-checkbox">
                <input 
                    type="checkbox" 
                    id="isPinned"
                    {% if note.is_pinned %}checked{% endif %}
                >
                <span>PIN NOTE</span>
            </label>
        </div>
        
        <textarea 
            id="noteContent" 
            class="note-content-editor"
            placeholder="Start writing... Use [[Note Title]] to link to other notes"
        >{% if note %}{{ note.content }}{% endif %}</textarea>
        
        <!-- PREVIEW PANE (Split view) -->
        <div id="previewPane" class="preview-pane" style="display:none;">
            <h3 class="preview-title">PREVIEW</h3>
            <div id="previewContent" class="preview-content"></div>
        </div>
    </div>
    
    <!-- SIDE PANEL: Backlinks & Suggestions -->
    <aside class="editor-sidebar">
        <div class="sidebar-section">
            <h3 class="section-title">ðŸ”— BACKLINKS</h3>
            <div id="backlinks" class="backlinks-list">
                <p class="muted-text">No backlinks yet</p>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3 class="section-title">ðŸ’¡ SUGGESTIONS</h3>
            <div id="suggestions" class="suggestions-list">
                <p class="muted-text">Type [[ to link notes</p>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3 class="section-title">ðŸ“Š STATS</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Words</span>
                    <span id="wordCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Characters</span>
                    <span id="charCount" class="stat-value">0</span>
                </div>
            </div>
        </div>
    </aside>
</div>

<input type="hidden" id="noteId" value="{% if note %}{{ note.id }}{% endif %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/notes-editor.js' %}"></script>
{% endblock %}
